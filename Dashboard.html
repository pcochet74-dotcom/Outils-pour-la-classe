<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Ent Classe Bruit ‚Äì Dashboard Prof</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
    }

    /* Barre du haut */
    .header {
      background: linear-gradient(to bottom, #2a9cc8, #268cb3);
      color: #fff;
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      height: 60px;
      display: flex;
      align-items: center;
      padding: 0 20px;
    }

    .menu-toggle {
      width: 42px;
      height: 42px;
      background-color: #ff8d2e;
      border: none;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      margin-right: 20px;
    }

    .menu-toggle span {
      width: 24px;
      height: 3px;
      background-color: white;
      margin: 3px 0;
      border-radius: 2px;
    }

    .site-title {
      font-size: 20px;
      font-weight: 600;
      color: white;
      margin: 0;
    }

    .navbar-icons {
      margin-left: auto;
    }

    .navbar-icons .nav-link {
      color: #fff;
      position: relative;
      padding: 0 12px;
    }

    .navbar-icons .nav-link:hover::after {
      width: 100%;
    }

    .navbar-icons .nav-link::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -4px;
      width: 0%;
      height: 3px;
      background-color: #ff8d2e;
      transition: width 0.25s ease-in-out;
    }

    /* Menu vertical */
    .sidebar {
      width: 230px;
      background: #fff;
      height: 100vh;
      padding-top: 80px;
      border-right: 1px solid #ddd;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 900;
      transition: transform 0.3s ease;
    }

    .sidebar.closed {
      transform: translateX(-230px);
    }

    .sidebar a {
      display: block;
      padding: 14px 20px;
      color: #333;
      text-decoration: none;
      font-size: 16px;
    }

    .sidebar a:hover {
      background: #e8f4fa;
    }

    /* Contenu principal */
    .content {
      margin-left: 230px;
      padding-top: 80px;
      padding-left: 20px;
      padding-right: 20px;
      transition: margin-left 0.3s ease;
    }

    .content.full {
      margin-left: 0;
    }

    /* Dashboard */
    #status {
      font-size: 24px;
      font-weight: bold;
      padding: 12px;
      border-radius: 8px;
      color: white;
      text-align: center;
      margin-bottom: 20px;
    }

    #chart {
      width: 100%;
      height: 300px;
    }
  </style>
</head>

<body>

<!-- Barre du haut -->
<header class="header">
  <button class="menu-toggle" id="menuToggle">
    <span></span><span></span><span></span>
  </button>

  <h1 class="site-title">Ent Classe Bruit</h1>

  <div class="navbar-icons">
    <a href="https://pcochet74-dotcom.github.io/Ent-classe-bruit/Accueil.html" class="nav-link" title="Accueil">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
        <path d="M20.584 13.536v7.458c0 .28-.098.512-.294.699a1.062 1.062 0 0 1-.667.307H13.91v-5.978h-3.817V22H4.383a.848.848 0 0 1-.668-.307 1.162 1.162 0 0 1-.293-.699v-7.569l8.567-7.375 8.568 7.375c.018.018.027.055.027.111Z" fill="currentColor"></path>
      </svg>
    </a>
  </div>
</header>

<!-- Menu vertical -->
<div class="sidebar" id="sidebar">
  <a href="#">üìä Mesures</a>
  <a href="#">‚öôÔ∏è Param√®tres</a>
  <a href="#">üìÅ Historique</a>
  <a href="#">üîß Calibration</a>
</div>

<!-- Contenu principal -->
<div class="content" id="content">
  <h1>üìä Dashboard ‚Äì Niveau sonore</h1>

  <div id="status">Chargement...</div>

  <canvas id="chart"></canvas>
</div>

<script>
  const sidebar = document.getElementById("sidebar");
  const content = document.getElementById("content");
  const menuToggle = document.getElementById("menuToggle");

  menuToggle.addEventListener("click", () => {
    sidebar.classList.toggle("closed");
    content.classList.toggle("full");
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const API_URL =
 "https://firestore.googleapis.com/v1/projects/ent-classe-bruit/databases/(default)/documents/bruit?key=AIzaSyAad_igf2VuhEWgtRZT4cvFtDLuh82AChI";

let volumes = [];
let timestamps = [];

async function fetchData() {
    const res = await fetch(API_URL);
    const data = await res.json();

    if (!data.documents) return;

    volumes = [];
    timestamps = [];

    data.documents.forEach(doc => {
        const f = doc.fields;
        volumes.push(f.volume.doubleValue);
        timestamps.push(new Date(parseInt(f.timestamp.integerValue)));
    });

    updateUI();
}

function updateUI() {
    const last = volumes[volumes.length - 1];

    const status = document.getElementById("status");
    if (last > 60) {
        status.style.background = "red";
        status.textContent = "üî¥ Trop de bruit (" + last.toFixed(1) + ")";
    } else {
        status.style.background = "green";
        status.textContent = "üü¢ Calme (" + last.toFixed(1) + ")";
    }

    chart.data.labels = timestamps.map(t => t.toLocaleTimeString());
    chart.data.datasets[0].data = volumes;
    chart.update();
}

const ctx = document.getElementById("chart").getContext("2d");
const chart = new Chart(ctx, {
    type: "line",
    data: {
        labels: [],
        datasets: [{
            label: "Volume sonore",
            data: [],
            borderColor: "#ff8d2e",
            borderWidth: 2,
            fill: false
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: { min: 0, max: 120 }
        }
    }
});

setInterval(fetchData, 2000);
fetchData();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
